<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Afirma - Grid Fijo</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="brand">
                <span class="brand-icon">üè¢</span>
                <span class="brand-text">ERP Afirma</span>
            </div>
        </header>

        <div class="app-shell">
            <nav class="sidebar">
                <div class="nav">
                    <a href="#" data-view="alta" class="active">
                        <span>üë•</span> Empleados
                    </a>
                    <a href="#" data-view="candidatos">
                        <span>üìù</span> Candidatos
                    </a>
                    <a href="#" data-view="inventario">
                        <span>üì¶</span> Inventario
                    </a>
                    <a href="#" data-view="catalogs">
                        <span>üóÇÔ∏è</span> Cat√°logos
                    </a>
                </div>
            </nav>

            <main class="content">
                <section id="alta" class="view">
                    <div class="view-header">
                        <h2>üë• Gesti√≥n de Empleados</h2>
                        <button id="add-employee-btn" class="btn btn-primary">
                            ‚ûï Agregar Empleado
                        </button>
                    </div>

                    <div class="card">
                        <div class="filters-section">
                            <div class="filters-grid">
                                <div class="filter-group">
                                    <input type="text" id="filter-name" placeholder="Buscar por nombre..." class="filter-input">
                                </div>
                                <div class="filter-group">
                                    <input type="text" id="filter-position" placeholder="Buscar por puesto..." class="filter-input">
                                </div>
                                <div class="filter-group">
                                    <input type="text" id="filter-entity" placeholder="Buscar por entidad..." class="filter-input">
                                </div>
                                <div class="filter-group">
                                    <select id="filter-status" class="filter-select">
                                        <option value="">Todos los estados</option>
                                        <option value="Activo">Activo</option>
                                        <option value="Inactivo">Inactivo</option>
                                        <option value="En licencia">En licencia</option>
                                    </select>
                                </div>
                                <div class="filter-actions">
                                    <button id="filter-search-btn" class="btn btn-secondary">üîç Buscar</button>
                                    <button id="filter-clear-btn" class="btn btn-ghost">üßπ Limpiar</button>
                                </div>
                            </div>
                        </div>

                        <div class="employee-grid-container">
                            <div class="employee-grid-wrapper">
                                <div id="employee-grid-loading" class="grid-message">
                                    <div class="spinner"></div>
                                    <p>Cargando empleados...</p>
                                </div>

                                <div id="employee-grid-empty" class="grid-message" style="display:none;">
                                    <p>üì≠ No se encontraron empleados</p>
                                </div>

                                <div id="employee-grid-error" class="grid-message" style="display:none;">
                                    <p>‚ö†Ô∏è <span id="error-message">Error al cargar empleados</span></p>
                                </div>

                                <table class="employee-table" id="employee-table" style="display:none;">
                                    <thead>
                                        <tr>
                                            <th style="min-width:80px">üÜî ID</th>
                                            <th style="min-width:200px">üë§ Nombre Completo</th>
                                            <th style="min-width:150px">üè¢ Entidad</th>
                                            <th style="min-width:180px">üíº Puesto</th>
                                            <th style="min-width:130px">üìç √Årea</th>
                                            <th style="min-width:150px">üéØ Proyecto</th>
                                            <th style="min-width:120px">üîß C√©lula</th>
                                            <th style="min-width:100px">üìä Estado</th>
                                            <th style="min-width:150px">‚öôÔ∏è Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employee-table-body">
                                        <!-- Los empleados se cargar√°n aqu√≠ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Scripts en orden correcto -->
    <script src="js/config.js?v=3.0"></script>
    <script src="js/employees.js?v=3.0"></script>
    <script src="js/ui.js?v=3.0"></script>
    
    <script>
        // Script de inicializaci√≥n simplificado
        console.log('üöÄ Iniciando ERP Afirma - Grid Fijo');
        
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üìã DOM cargado, iniciando carga de empleados...');
            
            try {
                // Verificar que las funciones est√©n disponibles
                console.log('üîç Verificando funciones:', {
                    fetchEmployees: typeof window.fetchEmployees,
                    renderEmployees: typeof window.renderEmployees,
                    showGridLoading: typeof window.showGridLoading
                });
                
                // Mostrar cargando
                if (typeof window.showGridLoading === 'function') {
                    window.showGridLoading();
                }
                
                // Esperar un poco para que todo est√© listo
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Cargar empleados
                if (typeof window.fetchEmployees === 'function') {
                    console.log('üì° Obteniendo empleados...');
                    const employees = await window.fetchEmployees();
                    console.log('üìä Empleados obtenidos:', employees?.length);
                    
                    if (typeof window.renderEmployees === 'function') {
                        console.log('üé® Renderizando empleados...');
                        window.renderEmployees(employees);
                        console.log('‚úÖ Grid renderizado exitosamente');
                    } else {
                        console.error('‚ùå renderEmployees no disponible');
                    }
                } else {
                    console.error('‚ùå fetchEmployees no disponible');
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                if (typeof window.showGridError === 'function') {
                    window.showGridError(error.message);
                }
            }
        });
        
        // Tambi√©n intentar despu√©s de que todo est√© cargado
        window.addEventListener('load', () => {
            console.log('üîÑ Window load - ejecutando carga de backup...');
            setTimeout(async () => {
                if (typeof window.reloadEmployees === 'function') {
                    await window.reloadEmployees();
                }
            }, 1000);
        });
    </script>
</body>
</html>